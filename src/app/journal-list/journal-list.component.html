<div class="page-container">
    <div class="page-header">
        <div class="header-left">
            <button mat-icon-button routerLink="/collections" class="back-btn"
                matTooltip="Back to Collections"><mat-icon>arrow_back</mat-icon></button>
            <div>
                <h2>{{ this.title }}</h2>
                <p class="header-subtitle">Thought fragments in this dimension</p>
            </div>
        </div>
        <button mat-flat-button class="create-btn" (click)="navigateToCreateJournal()"><mat-icon>add</mat-icon><span>New
                Journal</span></button>
    </div>

    <!-- Search & Sort Bar -->
    <div class="toolbar-row" *ngIf="!isLoading && journals.length > 0">
        <mat-form-field appearance="outline" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input matInput [formControl]="searchControl" placeholder="Search journals...">
        </mat-form-field>
        <mat-button-toggle-group [value]="sortMode" (change)="onSortChange($event.value)" class="sort-group">
            <mat-button-toggle value="newest"><mat-icon>arrow_downward</mat-icon>Newest</mat-button-toggle>
            <mat-button-toggle value="oldest"><mat-icon>arrow_upward</mat-icon>Oldest</mat-button-toggle>
            <mat-button-toggle value="name"><mat-icon>sort_by_alpha</mat-icon>Title</mat-button-toggle>
        </mat-button-toggle-group>
    </div>

    <!-- Loading -->
    <div class="loading-state" *ngIf="isLoading"><mat-spinner diameter="48"></mat-spinner>
        <p>Tuning into this dimension...</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && journals.length === 0">
        <div class="empty-icon">üîÆ</div>
        <h3>Eerily Quiet in Here...</h3>
        <p>This dimension is empty. Time to capture some thoughts before they slip through the multiverse.</p>
        <button mat-flat-button class="create-btn"
            (click)="navigateToCreateJournal()"><mat-icon>add</mat-icon><span>Capture a Thought</span></button>
    </div>

    <!-- No Results -->
    <div class="empty-state" *ngIf="!isLoading && journals.length > 0 && filteredJournals.length === 0">
        <div class="empty-icon">üîç</div>
        <h3>Nothing Found</h3>
        <p>No journals match "{{ searchControl.value }}". Try a different search.</p>
    </div>

    <!-- Card Grid -->
    <div class="card-grid" *ngIf="!isLoading && pagedJournals.length > 0">
        <mat-card *ngFor="let journal of pagedJournals; let i = index" class="journal-card" @cardAnim
            [style.animation-delay]="i * 60 + 'ms'" (click)="editJournal(journal.id)">
            <mat-card-content>
                <div class="card-header-row">
                    <mat-icon class="card-icon">description</mat-icon>
                    <div class="moods-container" style="display: flex; gap: 6px; align-items: center; flex-wrap: wrap;">
                        <span class="mood-chip" *ngIf="getMood(journal.mood)"
                            [matTooltip]="'Main: ' + getMood(journal.mood)!.label">
                            {{ getMood(journal.mood)!.emoji }} {{ getMood(journal.mood)!.label }}
                        </span>
                        <span class="mood-chip secondary-mood" *ngFor="let m of journal.additionalMoods"
                            [matTooltip]="getMood(m)?.label || ''" style="padding: 4px 8px;">
                            {{ getMood(m)?.emoji }}
                        </span>
                    </div>
                </div>
                <h3 class="card-title">{{ journal.title }}</h3>
                <p class="card-description">{{ journal.content || 'An empty thought...' }}</p>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Paginator -->
    <mat-paginator *ngIf="!isLoading && filteredJournals.length > pageSize" [length]="totalItems" [pageSize]="pageSize"
        [pageSizeOptions]="[6, 12, 24]" (page)="onPageChange($event)" class="cosmic-paginator">
    </mat-paginator>
</div>