<div class="page-container">
    <div class="page-header">
        <button mat-icon-button (click)="navigateBack()" class="back-btn"
            matTooltip="Back to Journals"><mat-icon>arrow_back</mat-icon></button>
        <h2>{{ isEditing ? 'Edit Journal' : 'New Journal' }}</h2>
    </div>
    <div class="loading-state" *ngIf="isLoading"><mat-spinner diameter="48"></mat-spinner>
        <p>Loading thought fragment...</p>
    </div>
    <div class="form-card glassmorphism" *ngIf="!isLoading">
        <div class="form-header">
            <mat-icon class="form-icon">description</mat-icon>
            <p class="form-subtitle">{{ isEditing ? 'Refine your captured thought' : 'Pour your thoughts into the void'
                }}</p>
        </div>
        <form [formGroup]="journalForm" (ngSubmit)="onSubmit()" class="cosmic-form">
            <mat-form-field appearance="outline">
                <mat-label>Journal Title</mat-label>
                <input matInput formControlName="title" placeholder="e.g., The meaning of existence">
                <mat-icon matPrefix>title</mat-icon>
                <mat-hint align="end">{{ journalForm.get('title')?.value?.length || 0 }}/100</mat-hint>
                <mat-error *ngIf="journalForm.get('title')?.hasError('required')">Title is required</mat-error>
                <mat-error *ngIf="journalForm.get('title')?.hasError('maxlength')">Max 100 characters</mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" class="content-field">
                <mat-label>Content</mat-label>
                <textarea matInput formControlName="content"
                    placeholder="Let your thoughts flow freely across dimensions..." rows="12"></textarea>
                <mat-icon matPrefix>edit_note</mat-icon>
                <mat-error *ngIf="journalForm.get('content')?.hasError('required')">Content is required</mat-error>
            </mat-form-field>

            <!-- Mood Selector -->
            <div class="mood-selector">
                <label class="mood-label">How are you feeling? <span class="mood-hint">(Select multiple, click star for
                        main)</span></label>
                <div class="mood-options">
                    <button *ngFor="let mood of moods" type="button" class="mood-btn"
                        [class.mood-selected]="isMoodSelected(mood.value)"
                        [class.mood-main]="journalForm.get('mood')?.value === mood.value"
                        (click)="toggleMood(mood.value)">
                        <span class="mood-emoji">{{ mood.emoji }}</span>
                        <span class="mood-text">{{ mood.label }}</span>
                        <mat-icon *ngIf="isMoodSelected(mood.value)" class="main-mood-star"
                            (click)="setMainMood(mood.value, $event)"
                            [class.active-star]="journalForm.get('mood')?.value === mood.value"
                            [matTooltip]="journalForm.get('mood')?.value === mood.value ? 'Main mood' : 'Set as main mood'">
                            star
                        </mat-icon>
                    </button>
                </div>
            </div>

            <div class="form-actions">
                <button mat-flat-button type="submit" class="submit-btn" [disabled]="journalForm.invalid">
                    <mat-icon>{{ isEditing ? 'save' : 'add_circle' }}</mat-icon><span>{{ isEditing ? 'Update Journal' :
                        'Capture Thought' }}</span>
                </button>
                <button mat-button type="button" *ngIf="isEditing" class="delete-btn" (click)="deleteJournal()">
                    <mat-icon>delete_outline</mat-icon><span>Delete</span>
                </button>
                <button mat-button type="button" class="cancel-btn" (click)="navigateBack()">Cancel</button>
            </div>
        </form>
    </div>
</div>